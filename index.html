<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/assets/style" />
    <title>C4K60 Radio Control Panel</title>
  </head>
  <body onload="getStatus(); queue()" class="container">
    <h1>C4K60 Live Radio Control Panel</h1>
    <h3>Welcome, Dương Tùng Anh!</h3>

    <div style="float: left">
      <fieldset style="width: 550px">
        <legend>Status</legend>
        <div id="status">Fetching data...</div>
      </fieldset>

      <div style="margin: 15px 0">
        <p style="color: red; display: none" id="error"></p>
        <code style="color: red; display: none" id="error_code"></code>
        <button
          onclick='handleAlert("hide")'
          style="display: none"
          class="btn btn-default"
        >
          OK, I know
        </button>
      </div>
      <fieldset
        style="width: 350px; display: inline-flex; flex-wrap: wrap; gap: 12px"
      >
        <legend>Radio control</legend>
        <button class="btn btn-default" onclick="shuffle()">
          Shuffle playing songs
        </button>
        <button class="btn btn-default" onclick="reloadOrder()">
          Reload song orders
        </button>
        <button class="btn btn-default" onclick="changeSong()">
          Change playing song
        </button>
        <button class="btn btn-default">Forward 10 seconds >></button>
        <button class="btn btn-default">Rewind 10 seconds <<</button>
        <button class="btn btn-default">Add song at the top of queue</button>
        <button class="btn btn-default">Add song at the bottom of queue</button>
        <button class="btn btn-default">Remove all queued songs</button>
        <button class="btn btn-default">Disable queue</button>
        <button class="btn btn-default">
          Send refresh emission event to users
        </button>
        <button class="btn btn-warning" onclick="restart()">
          (!!) Restart server
        </button>
        <button class="btn btn-danger" onclick="shutdown()">
          (!!!) Shutdown server
        </button>
      </fieldset>
    </div>

    <fieldset style="max-width: 550px; width: 100%; float: right">
      <legend>Queue</legend>
      <div id="queue">Fetching data...</div>
    </fieldset>

    <script>
      function handleAlert(type, msg, code) {
        type == "success" || type == "success_html"
          ? $("#error").css("color", "green")
          : $("#error").css("color", "red");
        if (!code) {
          $("#error").show();
          $("#error").html(
            msg +
              `<br><br><button onclick='handleAlert("hide")' class="btn btn-default">OK, I know</button>`
          );
        } else {
          $("#error").show();
          $("#error_code").show();
          $("#error").text(msg);
        }
        type == "success_html" && $("#error").html(msg + ``);
        code &&
          $("#error_code").html(
            code +
              `<button onclick='handleAlert("hide")' class="btn btn-default">OK, I know</button>`
          );
        if (type == "hide") {
          $("#error").hide();
          $("#error_code").hide();
        }
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function shuffle() {
        $.get("/admin/api/shuffle", function (data, status) {
          handleAlert("success", data);
        }).catch((err) =>
          handleAlert("error", "Failed!! Error: " + err.status)
        );
      }

      function getStatus() {
        if ($("#status").text() == "") {
          $("#status").text("Fetching data...");
        }
        $.get("/admin/api/status", function (data, status) {
          $("#status").html(data);
        });
      }

      function changeSong() {
        var videoToPlay = prompt("Type your YouTube video ID here:");
        if (videoToPlay != "") {
          $.get(
            "/admin/api/songs/change/" + videoToPlay,
            function (data, status) {
              handleAlert("success_html", data);
            }
          ).catch((err) =>
            handleAlert("error", "Failed!! Error: " + err.status)
          );
        } else {
          handleAlert("error", "Please enter the video ID correctly!");
        }
      }

      function reloadOrder() {
        $.get("/admin/api/songs/reload-order", function (data, status) {
          handleAlert("success", data);
        }).catch((err) => {
          handleAlert(
            "dont_hide",
            "Failed! Error: " + err.status + ". Server response with message: ",
            err.responseText
          );
        });
      }

      function queue() {
        if ($("#queue").text() == "") {
          $("#queue").text("Fetching data...");
        }
        $.get("/admin/api/queue", function (data, status) {
          $("#queue").html(data);
        });
      }

      function restart() {
        $.get("/admin/api/server/restart", (data, status) => {
          handleAlert("success", data);
        }).catch((err) => {
          handleAlert(
            "dont_hide",
            "Failed! Error: " + err.status + ". Server response with message: ",
            err.responseText
          );
        });
      }

      function shutdown() {
        if (
          confirm(
            "Are you sure you want to shutdown the server? Note that this action will destroy all activity including live radio and live chat functions."
          )
        ) {
          $.get("/admin/api/server/shutdown", (data, status) => {
            handleAlert("success", data);
          }).catch((err) => {
            handleAlert(
              "dont_hide",
              "Failed! Error: " +
                err.status +
                ". Server response with message: ",
              err.responseText
            );
          });
        }
      }

      setInterval(() => {
        getStatus();
        queue();
      }, 1000);
    </script>
  </body>
</html>
